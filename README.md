# bce-scripts
## Инструменты
### 1. `remove_trash.py`

Основной скрипт, используемый для уменьшения размера `.csv` файла, полученного из инструмента для нахождения клонов. Это достигается удалением из списка пар клонов **дубликатов** и **вложенных конструкций**.

+ **Дубликаты** находятся с точностью до параметра `-t threshold`: 
    * 1.0 - только полностью совпадающие клоны; 
    * 0.7 - порог, используемый в *BigCloneEval* для проверки найденных клонов;
    * *0.0 - любые пересекающиеся пары клонов*

+ **Вложенные конструкции** - две пары клонов, в одной из которых оба блока полностью покрыты блоками второй пары клонов.

### 2. `get_classes.py`

Скрипт для разбиения набора пар клонов на *классы* (*кластеры*), путём нахождения компонент связности в графе, где вершины — блоки кодов, а рёбра — пары клонов.
Выводит классы в формате `{dir,fn,start,end;...}` в файл.

### 3. `make_full.py`

Скрипт для нахождения *классов* в наборе пар клонов, и дополнения этого набора новыми парами клонов, чтобы классы стали полными подграфами (кликами). 

Не стоит запускать на больших файлах (примерный размер итогового файла можно оценить с помощью предыдущего скрипта `get_classes.py` и его вывода о количестве рёбер в графе, который получился бы). 

### 4. `convert_nicad.py`

Скрипт для преобразования результата работы **NiCad7** в `.xml` формате, в `.csv` формат, необходимый для **BigCloneEval**.

### 5. `convert_ccs.sh`

Скрипт для преобразования результата работы **CCSTokener**, в формат, необходимый для **BigCloneEval**.

## Отчёты

### 1. `ccs.report`

**CCSTokener** в режиме `bcb`, запущенный на всей директории `bcb_reduced`.

### 2. `ccs.shrink.report`

**CCSTokener** в режиме `bcb`, запущенный на всей директории `bcb_reduced` и обработанный скриптом `remove_trash.py`.

### 3. `nicad7.report`

**NiCad7**, запущенный на всей директории `bcb_reduced`.

### 4. `nicad7.shrink.report`

**NiCad7**, запущенный на всей директории `bcb_reduced` и обработанный скриптом `remove_trash.py`.

### 5. `nicad7-ccs.report`

Результат конкатенации `ccs.report` и `nicad7.report`.

### 6. `nicad7-ccs.shrink.report`

Результат конкатенации `ccs.report` и `nicad7.report`, обработанный скриптом `remove_trash.py`.

## Использование на инструментах для нахождения клонов

### Использование `remove_trash.py` на *CCSTokener*

Из двух отчётов `ccs.report` и `ccs.shrink.report` можно видеть, что размёр результата работы уменьшился на 6.3%, при чём отчёт **BigCloneEval** совершенно не изменился (ни одно число). То есть `remove_trash.py` успешно чистит результат **CCSTokener** от лишних пар клонов.

### Использование `remove_trash.py` на *NiCad7*

Из двух отчётов `nicad7.report` и `nicad7.shrink.report` опять же видно, что отчёт **BigCloneEval** никак не изменились, однако количество пар клонов уменьшилось на 30%, то есть почти в полтора раза.

### Использование `remove_trash.py` для слияния результатов *CCSTokener* и *NiCad7*

После простой конкатенации `ccs.report` и `nicad7.report` (`nicad7-ccs.report`) у нас получается достаточно много пар клонов — 7 миллионов. Однако после запуска на этом файле `remove_trash.py` (`nicad7-ccs.shrink.report`) мы получаем гораздо меньше — 4.7 миллионов, то есть на 33% меньше чем после конкатенации, и чуть-чуть меньше, чем у **CCSTokener** без скрипта (на 3%).

Относительно `ccs.report` и `nicad7.report` отчёт **BigCloneEval** только улучшился (что логично, потому что мы объединили их результаты).

Итого мы смогли объединить результаты работы двух инструментов, не увеличив размер файла (относительно максимального из двух), и только улучшив показания **BigCloneEval**.

<!-- ### Использование `make_full.py` на *CCSTokener*

`make_full.py` дополняет набор пар клонов до такого, в котором все классы полностью включены в набор. Делать бы такое для полного набора клонов на `bcb_reduced`, найденных **CCSTokener** было бы очень затратно по памяти, потому что их там получилось бы примерно 3 миллиарда. Поэтому мы запускаем `make_full.py` на результате работы только на отдельных субдиректориях `bcb_reduced`, и смотрим отчёт **BigCloneEval** только по этим субдиректориям.

В качестве примера запустим **CCSTokener** на `bcb_reduced/4` и обработаем результат скриптом `make_full.py`. *To be continued...* -->